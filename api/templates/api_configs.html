<!-- API Configuration Interface -->
    <div class="flex h-full w-full relative">
        <!-- Sidebar Navigation -->
        <div class="fixed left-0 top-0 z-50 flex-shrink-0 w-64 md:w-64 w-16 h-full theme-bg-surface theme-border border-r">
            <div class="p-4 pt-4">
                <h3 class="text-lg font-semibold theme-text-primary mb-4 hidden md:block">Documents API</h3>
                <nav class="space-y-2" aria-label="Sidebar Navigation">
                    <button id="configs-tab" class="sidebar-nav-item active w-full flex items-center md:px-3 px-2 py-2 rounded-lg text-sm font-medium transition-colors duration-200" title="APIs">
                        <i data-lucide="settings" class="h-4 w-4 md:mr-3 mr-0 mx-auto md:mx-0"></i>
                        <span class="hidden md:inline">APIs</span>
                    </button>
                    <button id="usage-tab" class="sidebar-nav-item w-full flex items-center md:px-3 px-2 py-2 rounded-lg text-sm font-medium transition-colors duration-200" title="Usage">
                        <i data-lucide="activity" class="h-4 w-4 md:mr-3 mr-0 mx-auto md:mx-0"></i>
                        <span class="hidden md:inline">Usage</span>
                    </button>
                    <button id="users-tab" class="sidebar-nav-item w-full flex items-center md:px-3 px-2 py-2 rounded-lg text-sm font-medium transition-colors duration-200" title="Top Users">
                        <i data-lucide="users" class="h-4 w-4 md:mr-3 mr-0 mx-auto md:mx-0"></i>
                        <span class="hidden md:inline">Top Users</span>
                    </button>
                </nav>
            </div>
        </div>

        <!-- Content Area -->
        <div class="flex-1 overflow-y-auto theme-bg-background md:ml-64 ml-16">
            <div class="p-6">

                <!-- Configurations Section -->
                <div id="configs-section" class="tab-content">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold theme-text-primary">Documents API</h2>
                        <p class="theme-text-secondary mt-1">Manage your API configurations and access settings</p>
                    </div>

                    <!-- Actions Bar -->
                    <div class="mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                        <!-- Search Bar -->
                        <div class="relative max-w-md flex-1">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i data-lucide="search" class="h-5 w-5 theme-text-muted"></i>
                            </div>
                            <input type="text" id="config-search" class="uk-input pl-10 pr-4 py-3 w-full rounded-lg theme-border border theme-bg-surface focus:ring-2 focus:ring-blue-500 focus:border-blue-500" style="color: var(--color-text-primary);" placeholder="Search configurations...">
                        </div>

                        <!-- Create Button -->
                        <div class="flex items-center space-x-3">
                            <button id="create-config-btn" class="bg-transparent hover:theme-bg-surface theme-text-secondary hover:theme-text-primary px-3 py-2 rounded-lg flex items-center space-x-2 font-medium transition-all duration-200 border theme-border hover:theme-text-primary">
                                <i data-lucide="plus" class="h-4 w-4"></i>
                                <span>Documents API</span>
                            </button>
                            <button id="refresh-configs-btn" class="p-2.5 rounded-lg theme-text-muted hover:theme-text-primary hover:theme-bg-surface transition-all duration-200">
                                <i data-lucide="refresh-cw" class="h-4 w-4"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Skeleton Loading State -->
                    <div id="configs-loading" class="space-y-4 hidden">
                        <!-- API Config Skeleton Items -->
                        <div class="theme-bg-surface rounded-xl shadow-sm theme-border border animate-pulse">
                            <div class="p-6">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="flex-1">
                                        <div class="h-6 theme-border rounded w-48 mb-2"></div>
                                        <div class="h-4 theme-border rounded w-32"></div>
                                    </div>
                                    <div class="flex space-x-2">
                                        <div class="h-8 w-8 theme-border rounded"></div>
                                        <div class="h-8 w-8 theme-border rounded"></div>
                                        <div class="h-8 w-8 theme-border rounded"></div>
                                    </div>
                                </div>
                                <div class="grid grid-cols-2 gap-6">
                                    <div class="space-y-2">
                                        <div class="h-4 theme-border rounded w-20"></div>
                                        <div class="space-y-1">
                                            <div class="h-6 theme-border rounded w-24"></div>
                                            <div class="h-6 theme-border rounded w-28"></div>
                                        </div>
                                    </div>
                                    <div class="space-y-2">
                                        <div class="h-4 theme-border rounded w-24"></div>
                                        <div class="space-y-1">
                                            <div class="h-6 theme-border rounded w-32"></div>
                                            <div class="h-6 theme-border rounded w-28"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex justify-between items-center mt-4">
                                    <div class="h-4 theme-border rounded w-32"></div>
                                    <div class="h-4 theme-border rounded w-16"></div>
                                </div>
                            </div>
                        </div>
                        <!-- Repeat skeleton for 3 items -->
                        <div class="theme-bg-surface rounded-xl shadow-sm theme-border border animate-pulse">
                            <div class="p-6">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="flex-1">
                                        <div class="h-6 theme-border rounded w-48 mb-2"></div>
                                        <div class="h-4 theme-border rounded w-32"></div>
                                    </div>
                                    <div class="flex space-x-2">
                                        <div class="h-8 w-8 theme-border rounded"></div>
                                        <div class="h-8 w-8 theme-border rounded"></div>
                                        <div class="h-8 w-8 theme-border rounded"></div>
                                    </div>
                                </div>
                                <div class="grid grid-cols-2 gap-6">
                                    <div class="space-y-2">
                                        <div class="h-4 theme-border rounded w-20"></div>
                                        <div class="space-y-1">
                                            <div class="h-6 theme-border rounded w-24"></div>
                                            <div class="h-6 theme-border rounded w-28"></div>
                                        </div>
                                    </div>
                                    <div class="space-y-2">
                                        <div class="h-4 theme-border rounded w-24"></div>
                                        <div class="space-y-1">
                                            <div class="h-6 theme-border rounded w-32"></div>
                                            <div class="h-6 theme-border rounded w-28"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex justify-between items-center mt-4">
                                    <div class="h-4 theme-border rounded w-32"></div>
                                    <div class="h-4 theme-border rounded w-16"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Configurations List -->
                    <div class="space-y-4" id="configs-list">
                        <!-- Configurations will be populated dynamically -->
                    </div>

                    <!-- Empty State -->
                    <div id="configs-empty" class="text-center py-12 hidden">
                        <i data-lucide="settings" class="h-12 w-12 theme-text-muted mx-auto mb-4"></i>
                        <h3 class="text-lg font-medium theme-text-primary mb-2">No API configurations found</h3>
                        <p class="theme-text-secondary mb-4">Create your first API configuration to get started</p>
                        <button id="empty-create-btn" class="bg-transparent hover:theme-bg-surface theme-text-secondary hover:theme-text-primary px-3 py-2 rounded-lg flex items-center space-x-2 font-medium transition-all duration-200 border theme-border hover:theme-text-primary mx-auto">
                            <i data-lucide="plus" class="h-4 w-4"></i>
                            <span>Documents API</span>
                        </button>
                    </div>

                    <!-- Error State -->
                    <div id="configs-error" class="text-center py-12 hidden">
                        <i data-lucide="alert-circle" class="h-12 w-12 theme-text-danger mx-auto mb-4"></i>
                        <h3 class="text-lg font-medium theme-text-primary mb-2">Error loading configurations</h3>
                        <p class="theme-text-secondary mb-4" id="configs-error-message">An error occurred while loading API configurations</p>
                        <button id="retry-configs-btn" class="theme-bg-primary hover:opacity-90 text-white px-4 py-2.5 rounded-lg font-medium transition-all duration-200">Try Again</button>
                    </div>
                </div>

                <!-- Usage Section -->
                <div id="usage-section" class="tab-content hidden">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold theme-text-primary">API Usage</h2>
                        <p class="theme-text-secondary mt-1">Monitor API usage metrics and statistics</p>
                    </div>

                    <!-- Usage Metrics Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <!-- Total Requests -->
                        <div class="theme-bg-surface rounded-xl p-6 shadow-sm theme-border border">
                            <div class="flex items-center">
                                <div class="p-2 rounded-lg" style="background-color: rgba(var(--color-primary-rgb, 30, 136, 229), 0.1);">
                                    <i data-lucide="activity" class="h-6 w-6 theme-primary"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium theme-text-secondary">Total Requests</p>
                                    <p class="text-2xl font-bold theme-text-primary" id="total-requests">0</p>
                                </div>
                            </div>
                        </div>

                        <!-- Input Size -->
                        <div class="theme-bg-surface rounded-xl p-6 shadow-sm theme-border border">
                            <div class="flex items-center">
                                <div class="p-2 rounded-lg" style="background-color: rgba(var(--color-success-rgb, 40, 167, 69), 0.1);">
                                    <i data-lucide="download" class="h-6 w-6 theme-success"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium theme-text-secondary">Input Size</p>
                                    <p class="text-2xl font-bold theme-text-primary" id="total-input">0 B</p>
                                </div>
                            </div>
                        </div>

                        <!-- Output Size -->
                        <div class="theme-bg-surface rounded-xl p-6 shadow-sm theme-border border">
                            <div class="flex items-center">
                                <div class="p-2 rounded-lg" style="background-color: rgba(var(--color-info-rgb, 23, 162, 184), 0.1);">
                                    <i data-lucide="upload" class="h-6 w-6 theme-info"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium theme-text-secondary">Output Size</p>
                                    <p class="text-2xl font-bold theme-text-primary" id="total-output">0 B</p>
                                </div>
                            </div>
                        </div>

                        <!-- Active Configs -->
                        <div class="theme-bg-surface rounded-xl p-6 shadow-sm theme-border border">
                            <div class="flex items-center">
                                <div class="p-2 rounded-lg" style="background-color: rgba(var(--color-warning-rgb, 255, 193, 7), 0.1);">
                                    <i data-lucide="settings" class="h-6 w-6 theme-warning"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium theme-text-secondary">Active Configs</p>
                                    <p class="text-2xl font-bold theme-text-primary" id="active-configs">0</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Usage Details -->
                    <div class="theme-bg-surface rounded-xl p-6 shadow-sm theme-border border">
                        <h3 class="text-lg font-semibold theme-text-primary mb-4">Usage by Configuration</h3>
                        <div id="usage-details">
                            <!-- Usage details will be populated dynamically -->
                        </div>
                    </div>
                </div>

                <!-- Top Users Section -->
                <div id="users-section" class="tab-content hidden">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold theme-text-primary">Top Users</h2>
                        <p class="theme-text-secondary mt-1">View most active users across all API configurations</p>
                    </div>

                    <!-- Top Users List -->
                    <div class="space-y-4" id="users-list">
                        <!-- Top users will be populated dynamically -->
                    </div>

                    <!-- Empty State -->
                    <div id="users-empty" class="text-center py-12 hidden">
                        <i data-lucide="users" class="h-12 w-12 theme-text-muted mx-auto mb-4"></i>
                        <h3 class="text-lg font-medium theme-text-primary mb-2">No user activity found</h3>
                        <p class="theme-text-secondary">User activity will appear here once API requests are made</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create/Edit Configuration Modal -->
    <div id="config-modal" class="uk-modal">
        <div class="uk-modal-dialog uk-modal-body theme-bg-surface rounded-lg" style="max-width: 600px;">
            <button class="uk-modal-close-default" type="button" uk-close></button>
            <h2 class="uk-modal-title theme-text-primary mb-6" id="modal-title">Create API Configuration</h2>

            <form id="config-form" class="space-y-6">
                <input type="hidden" id="config-id" value="">

                <!-- Users Section -->
                <div class="uk-form-row">
                    <label class="uk-form-label theme-text-primary font-medium mb-3">Authorized Users</label>
                    <div class="uk-form-controls">
                        <div class="user-input-container relative">
                            <input
                                type="text"
                                id="users-autocomplete-input"
                                class="uk-input w-full border theme-border rounded-lg p-3"
                                placeholder="Type to search users..."
                                autocomplete="off"
                            >
                            <div id="users-autocomplete-popup" class="autocomplete-popup hidden absolute z-50 w-full theme-bg-surface border theme-border rounded-lg shadow-lg mt-1 max-h-48 overflow-y-auto">
                                <!-- User suggestions will be populated here -->
                            </div>
                        </div>
                        <!-- Selected Users Display -->
                        <div id="selected-users-container" class="selected-users hidden mt-3">
                            <div class="theme-bg-background rounded-xl p-4">
                                <div class="flex items-center justify-between mb-3">
                                    <h4 class="text-sm font-medium theme-text-primary">Selected Users</h4>
                                    <button type="button" onclick="clearAllUsers()" class="clear-all-users-btn text-xs px-3 py-1.5 theme-danger rounded-lg transition-all duration-200" style="background-color: rgba(var(--color-danger-rgb, 220, 53, 69), 0.1); --tw-bg-opacity: 1;">Clear All</button>
                                </div>
                                <div id="selected-users-list" class="space-y-2 max-h-48 overflow-y-auto users-list">
                                    <!-- Selected users will be displayed here -->
                                </div>
                                <div class="mt-3 pt-3 theme-border border-t">
                                    <span class="text-sm theme-text-secondary users-summary">0 users selected</span>
                                </div>
                            </div>
                        </div>
                        <input type="hidden" id="config-users" required>
                        <div class="uk-form-help theme-text-secondary mt-2">Search and select users for this API config. Selected users will appear below.</div>
                    </div>
                </div>

                <!-- Datasets Section -->
                <div class="uk-form-row">
                    <label class="uk-form-label theme-text-primary font-medium mb-3">Authorized Datasets</label>
                    <div class="uk-form-controls">
                        <div class="dataset-input-container relative">
                            <input
                                type="text"
                                id="datasets-autocomplete-input"
                                class="uk-input w-full border theme-border rounded-lg p-3"
                                placeholder="Type to search documents..."
                                autocomplete="off"
                            >
                            <div id="datasets-autocomplete-popup" class="autocomplete-popup hidden absolute z-50 w-full theme-bg-surface border theme-border rounded-lg shadow-lg mt-1 max-h-48 overflow-y-auto">
                                <!-- Dataset suggestions will be populated here -->
                            </div>
                        </div>
                        <!-- Selected Datasets Display -->
                        <div id="selected-datasets-container" class="selected-datasets hidden mt-3">
                            <div class="theme-bg-background rounded-xl p-4">
                                <div class="flex items-center justify-between mb-3">
                                    <h4 class="text-sm font-medium theme-text-primary">Selected Datasets</h4>
                                    <button type="button" onclick="clearAllDatasets()" class="clear-all-datasets-btn text-xs px-3 py-1.5 theme-danger rounded-lg transition-all duration-200" style="background-color: rgba(var(--color-danger-rgb, 220, 53, 69), 0.1); --tw-bg-opacity: 1;">Clear All</button>
                                </div>
                                <div id="selected-datasets-list" class="space-y-2 max-h-48 overflow-y-auto datasets-list">
                                    <!-- Selected datasets will be displayed here -->
                                </div>
                                <div class="mt-3 pt-3 theme-border border-t">
                                    <span class="text-sm theme-text-secondary datasets-summary">0 datasets selected</span>
                                </div>
                            </div>
                        </div>
                        <input type="hidden" id="config-datasets" required>
                        <div class="uk-form-help theme-text-secondary mt-2">Search and select documents for this API config. Selected documents will appear below.</div>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="uk-modal-footer pt-6 border-t theme-border bg-theme-surface flex justify-end items-center gap-3">
                    <button type="button" class="px-4 py-2.5 rounded-lg border theme-border theme-text-secondary hover:theme-text-primary hover:theme-bg-surface transition-all duration-200 uk-modal-close">Cancel</button>
                    <button type="submit" id="config-submit-btn" class="theme-bg-primary hover:opacity-90 text-white px-4 py-2.5 rounded-lg font-medium transition-all duration-200">
                        <span id="config-btn-text">Create Configuration</span>
                        <i id="config-spinner" class="hidden uk-spinner uk-spinner-small ml-2"></i>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- API Config Statistics Modal -->
    <div id="config-stats-modal" class="uk-modal">
        <div class="uk-modal-dialog uk-modal-body theme-bg-surface rounded-lg" style="max-width: 800px;">
            <button class="uk-modal-close-default" type="button" uk-close></button>
            <h2 class="uk-modal-title theme-text-primary mb-6" id="stats-modal-title">API Usage Statistics</h2>

            <div id="stats-content">
                <div class="stats-loading text-center py-8">
                    <div class="uk-spinner uk-spinner-medium theme-text-muted mx-auto mb-4"></div>
                    <p class="theme-text-secondary">Loading statistics...</p>
                </div>
            </div>

            <div class="uk-modal-footer pt-6 border-t theme-border bg-theme-surface flex justify-end items-center">
                <button class="px-4 py-2.5 rounded-lg border theme-border theme-text-secondary hover:theme-text-primary hover:theme-bg-surface transition-all duration-200 uk-modal-close">Close</button>
            </div>
        </div>
    </div>

    <style>
    .sidebar-nav-item {
        color: var(--color-text-muted);
        background: transparent;
        transition: all 0.2s ease;
        text-align: left;
        border: none;
    }

    .sidebar-nav-item:hover {
        color: var(--color-text-secondary);
        background-color: rgba(var(--color-text-muted-rgb, 173, 181, 189), 0.1);
    }

    .sidebar-nav-item.active {
        color: var(--color-primary);
        background-color: rgba(var(--color-primary-rgb, 30, 136, 229), 0.1);
    }

    .tab-content {
        @apply block;
    }

    .tab-content.hidden {
        @apply hidden;
    }

    /* Autocomplete Styles */
    .autocomplete-popup {
        z-index: 1000;
    }

    .autocomplete-item {
        @apply p-3 cursor-pointer transition-colors duration-150;
    }

    .autocomplete-item:hover,
    .autocomplete-item.selected {
        background-color: var(--color-background) !important;
    }

    .autocomplete-item.already-selected {
        @apply opacity-50;
    }


    /* Selected Items Styles */
    .selected-items-list {
        @apply border theme-border rounded-lg p-3;
        min-height: 60px;
    }

    .selected-item {
        @apply flex items-center justify-between p-2 rounded-lg mb-2 last:mb-0;
        background-color: var(--color-background) !important;
    }

    .selected-item-remove {
        @apply cursor-pointer p-1 rounded;
        color: var(--color-danger) !important;
        transition: opacity 0.2s ease;
    }

    .selected-item-remove:hover {
        opacity: 0.8;
    }

    /* API Config Cards */
    .api-config-card {
        transition: all 0.2s ease;
    }

    .api-config-card:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .api-config-actions {
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .api-config-card:hover .api-config-actions {
        opacity: 1;
    }

    /* API Action Button Styles - matching documents interface */
    .api-action-btn {
        padding: 0.5rem;
        border-radius: 0.5rem;
        transition: all 0.2s ease;
        border: none;
        background: transparent;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #6b7280;
    }

    .api-action-btn:hover {
        background-color: #f3f4f6;
        color: #374151;
    }

    /* Dark mode styles */
    [data-theme="dark"] .api-action-btn {
        color: #9ca3af;
    }

    [data-theme="dark"] .api-action-btn:hover {
        background-color: #374151;
        color: #d1d5db;
    }

    /* Danger button variant */
    .api-action-btn-danger {
        color: #f87171 !important;
    }

    .api-action-btn-danger:hover {
        background-color: #fef2f2 !important;
        color: #dc2626 !important;
    }

    [data-theme="dark"] .api-action-btn-danger:hover {
        background-color: rgba(185, 28, 28, 0.2) !important;
        color: #f87171 !important;
    }

    /* Skeleton loading styles using theme variables */
    .animate-pulse .theme-border {
        background-color: var(--color-border) !important;
    }

    /* Statistics Modal Styles */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .stats-card {
        @apply theme-bg-surface rounded-lg p-4 theme-border border;
    }

    .stats-card-header {
        @apply flex items-center gap-3 mb-2;
    }

    .stats-card-icon {
        @apply h-5 w-5 theme-primary;
    }

    .stats-card-value {
        @apply text-2xl font-bold theme-text-primary;
    }

    .stats-user-chart {
        @apply space-y-3;
    }

    .stats-user-bar {
        @apply flex items-center gap-3;
    }

    .stats-user-bar-container {
        @apply flex-1 relative rounded-full h-6;
        background-color: var(--color-background) !important;
    }

    .stats-user-bar-fill {
        @apply h-full rounded-full;
        background-color: var(--color-primary) !important;
        transition: width 0.3s ease;
    }

    .stats-user-bar-value {
        @apply absolute right-2 top-0 text-xs font-medium theme-text-primary leading-6;
    }

    /* Override UIkit modal footer default white background */
    .uk-modal-footer {
        background-color: var(--color-surface) !important;
        border-top-color: var(--color-border) !important;
        display: flex !important;
        justify-content: flex-end !important;
        align-items: center !important;
        text-align: right !important;
        margin: 0 !important;
        padding-left: 1.5rem !important;
        padding-right: 1.5rem !important;
    }

    /* Scrollable list styling for API config cards */
    .api-config-card .hover\:theme-bg-surface:hover {
        background-color: var(--color-surface) !important;
    }

    /* Custom scrollbar for the lists */
    .api-config-card .overflow-y-auto::-webkit-scrollbar {
        width: 6px;
    }

    .api-config-card .overflow-y-auto::-webkit-scrollbar-track {
        background: transparent;
    }

    .api-config-card .overflow-y-auto::-webkit-scrollbar-thumb {
        background-color: rgba(156, 163, 175, 0.5);
        border-radius: 3px;
    }

    .api-config-card .overflow-y-auto::-webkit-scrollbar-thumb:hover {
        background-color: rgba(156, 163, 175, 0.7);
    }

    [data-theme="dark"] .api-config-card .overflow-y-auto::-webkit-scrollbar-thumb {
        background-color: rgba(75, 85, 99, 0.5);
    }

    [data-theme="dark"] .api-config-card .overflow-y-auto::-webkit-scrollbar-thumb:hover {
        background-color: rgba(75, 85, 99, 0.7);
    }
    </style>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();
    </script>
